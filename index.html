<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindGuard - Your Companion in Mental Wellbeing</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --navy: #0B1220;
            --teal: #7DD3FC;
            --slate: #46607A;
            --cream: #F7FBFF;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0B1220 0%, #1E293B 100%);
            color: var(--cream);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Auth Modal */
        .auth-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(11, 18, 32, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .auth-content {
            background: #1E293B;
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            border: 2px solid var(--teal);
        }
        
        .trial-notice {
            background: var(--teal);
            color: var(--navy);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 600;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
        }
        
        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: var(--navy);
            border: none;
            color: var(--teal);
            cursor: pointer;
            font-weight: 600;
        }
        
        .auth-tab.active {
            background: var(--teal);
            color: var(--navy);
        }
        
        .auth-form input {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 2px solid var(--slate);
            border-radius: 10px;
            background: var(--navy);
            color: white;
            font-size: 1rem;
        }
        
        .auth-form input:focus {
            outline: none;
            border-color: var(--teal);
        }
        
        .auth-btn {
            width: 100%;
            padding: 1rem;
            background: var(--teal);
            color: var(--navy);
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .auth-error {
            color: var(--danger);
            margin: 0.5rem 0;
            text-align: center;
        }
        
        /* Main App */
        .app-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
            padding-top: 70px;
        }
        
        .header {
            text-align: center;
            padding: 2rem 0;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--teal);
            margin-bottom: 1rem;
        }
        
        .tagline {
            color: var(--teal);
            margin-bottom: 2rem;
        }
        
        .section {
            background: rgba(125, 211, 252, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(125, 211, 252, 0.2);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .chat-container {
            background: rgba(247, 251, 255, 0.05);
            border-radius: 15px;
            height: 300px;
            overflow-y: auto;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(125, 211, 252, 0.3);
        }
        
        .chat-message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 15px;
            max-width: 80%;
        }
        
        .user-message {
            background: var(--teal);
            color: var(--navy);
            margin-left: auto;
            text-align: right;
        }
        
        .ai-message {
            background: rgba(70, 96, 122, 0.3);
            color: var(--cream);
            margin-right: auto;
        }
        
        .chat-input-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .chat-input {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--slate);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(247, 251, 255, 0.1);
            color: var(--cream);
        }
        
        .send-btn {
            background: var(--teal);
            color: var(--navy);
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .emergency-btn {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
            border: none;
            padding: 1.5rem 2rem;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            margin: 1rem 0;
            width: 100%;
        }
        
        .btn {
            background: var(--teal);
            color: var(--navy);
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin: 0.5rem;
        }
        
        /* User Panel */
        .user-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            z-index: 999;
            font-size: 12px;
            max-width: 250px;
        }
        
        .user-email {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--teal);
        }
        
        .user-status {
            background: var(--success);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 3px;
            font-size: 10px;
            margin-bottom: 0.5rem;
        }
        
        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 0.3rem 0.6rem;
            border-radius: 3px;
            margin-top: 0.5rem;
            cursor: pointer;
            font-size: 10px;
            width: 100%;
        }
        
        /* Paywall */
        .paywall {
            text-align: center;
            padding: 2rem;
            background: white;
            color: var(--navy);
            border-radius: 15px;
            margin: 2rem 0;
        }
        
        .stripe-btn {
            background: #635BFF;
            color: white;
            border: none;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            margin: 1rem 0;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .app-container { padding: 0.5rem; padding-top: 80px; }
            .chat-container { height: 250px; }
            .user-panel { top: 5px; right: 5px; left: 5px; max-width: none; }
        }
    </style>
</head>
<body>
    <!-- Auth Modal -->
    <div id="auth-modal" class="auth-modal">
        <div class="auth-content">
            <div class="trial-notice">
                ‚≠ê 3-Day Free Trial ‚Ä¢ Then ¬£10/month
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showTab('login')">Login</button>
                <button class="auth-tab" onclick="showTab('signup')">Sign Up</button>
            </div>
            
            <div id="login-form" class="auth-form">
                <input type="email" id="login-email" placeholder="Email" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <div id="login-error" class="auth-error"></div>
                <button class="auth-btn" onclick="login()">Login</button>
            </div>
            
            <div id="signup-form" class="auth-form" style="display: none;">
                <input type="text" id="signup-name" placeholder="Full Name" required>
                <input type="email" id="signup-email" placeholder="Email" required>
                <input type="password" id="signup-password" placeholder="Password (min 6 characters)" required>
                <div id="signup-error" class="auth-error"></div>
                <button class="auth-btn" onclick="signup()">Start Free Trial</button>
            </div>
        </div>
    </div>

    <!-- User Panel -->
    <div id="user-panel" class="user-panel" style="display: none;">
        <div class="user-email" id="user-email"></div>
        <div class="user-status" id="user-status">TRIAL ACTIVE</div>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <!-- Paywall -->
    <div id="paywall" class="paywall" style="display: none;">
        <h2>üîí Subscription Required</h2>
        <p>Your free trial has ended. Subscribe to continue using MindGuard.</p>
        <button class="stripe-btn" onclick="subscribe()">Subscribe Now - ¬£10/month</button>
    </div>

    <!-- Main App -->
    <div id="app-content" style="display: none;">
        <div class="app-container">
            <div class="header">
                <div class="logo">MindGuard</div>
                <p class="tagline">Your Companion in Mental Wellbeing</p>
            </div>

            <div class="section">
                <h2>üí¨ Chat with MindGuard AI</h2>
                <div class="chat-container" id="chat-container">
                    <div class="chat-message ai-message">
                        <strong>MindGuard:</strong> Hello! I'm here to support you. I'm trained in CBT techniques and mental health support. How are you feeling today?
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chat-input" placeholder="Type your message here..." onkeypress="handleChatInput(event)">
                    <button class="send-btn" onclick="sendMessage()">Send</button>
                </div>
                
                <div style="text-align: center; margin-top: 1rem;">
                    <button class="btn" onclick="quickResponse('I\\'m feeling really anxious and overwhelmed today')">üè• I'm Anxious</button>
                    <button class="btn" onclick="quickResponse('I\\'m feeling depressed and hopeless')">üíî I'm Depressed</button>
                    <button class="btn" onclick="quickResponse('I need help with stress management')">üí® Stress Help</button>
                </div>
            </div>

            <div class="section">
                <h2>üÜò Emergency Assistance</h2>
                <p>Your safety is our priority. Immediate help is available when you need it most.</p>
                
                <button class="emergency-btn" onclick="showEmergencyModal()">
                    ‚ö° IMMEDIATE HELP - 24/7 SUPPORT
                </button>
                
                <div style="margin-top: 1rem;">
                    <p><strong>Emergency Contacts:</strong></p>
                    <p>üìû UK Samaritans: 116 123 (FREE)</p>
                    <p>üìû NHS: 111 (Non-emergency)</p>
                    <p>üìû Emergency: 999</p>
                </div>
            </div>

            <div class="section">
                <h2>üéì CBT Tools & Resources</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
                    <button class="btn" onclick="startBreathingExercise()">üí® Breathing Exercise</button>
                    <button class="btn" onclick="startGroundingExercise()">üåç 5-4-3-2-1 Grounding</button>
                    <button class="btn" onclick="showGratitudePrompt()">‚≠ê Gratitude Journal</button>
                    <button class="btn" onclick="showMoodTracker()">üìà Mood Tracker</button>
                </div>
            </div>
            
            <!-- Safety Disclaimer -->
            <div style="text-align: center; margin-top: 2rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 10px;">
                <p style="color: var(--danger); font-size: 0.9rem;">
                    <strong>‚ö†Ô∏è Important:</strong> MindGuard AI provides support but is not a replacement for professional medical care. 
                    In crisis situations, please contact emergency services immediately.
                </p>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION - SET YOUR KEYS HERE
        const CONFIG = {
            STRIPE_PUBLISHABLE_KEY: 'pk_test_your_key_here', // Replace with your test key
            STRIPE_PRICE_ID: 'price_your_price_id', // Replace with your price ID
            APP_URL: window.location.origin
        };

        // Enhanced CBT-trained AI responses
        const CBT_RESPONSES = {
            anxiety: [
                "I hear that you're feeling anxious. That's completely valid. Let's try a technique called square breathing together: Breathe in for 4 seconds, hold for 4 seconds, breathe out for 4 seconds, hold for 4 seconds. Repeat this cycle 4 times. How does that feel?",
                "Anxiety can feel overwhelming, but remember that it's a normal response. Let's identify what specifically is triggering your anxiety. Can you pinpoint what thoughts are coming up for you right now?",
                "I understand the weight of anxiety. Let's try grounding ourselves. Name 5 things you can see, 4 things you can touch, 3 things you can hear, 2 things you can smell, and 1 thing you can taste. This can help bring you back to the present moment."
            ],
            depression: [
                "I'm sorry you're feeling this way. Depression can make everything feel heavy. Remember that this feeling is temporary, even if it doesn't feel that way right now. Would you like to try scheduling one small, achievable activity today?",
                "Thank you for sharing how you're feeling. It takes courage to acknowledge depression. Let's focus on self-compassion right now. What's one kind thing you can do for yourself today, no matter how small?",
                "I hear the pain in your words. Depression can be incredibly isolating. Let's try a gratitude practice - can you think of one thing, even something very small, that you're grateful for today?"
            ],
            stress: [
                "Stress can feel overwhelming. Let's break things down into smaller, manageable pieces. What's one tiny step you can take right now to reduce your stress, even just a little bit?",
                "I understand you're feeling stressed. Let's try progressive muscle relaxation: Tense and then relax each muscle group starting from your toes up to your head. Notice the difference between tension and relaxation.",
                "Stress management is about taking things one moment at a time. Would you like to try a quick mindfulness exercise? Focus on your breath for just 60 seconds, noticing each inhale and exhale without judgment."
            ],
            crisis: [
                "I'm hearing that you're in significant distress. Your safety is the most important thing right now. Please consider reaching out to emergency services or a crisis hotline. You can call Samaritans at 116 123 (free) or emergency services at 999. You don't have to go through this alone.",
                "This sounds like a very difficult situation. I want to emphasize that professional support is available right now. Would you be open to calling a crisis line? There are people trained to help with exactly what you're experiencing.",
                "I'm concerned about your wellbeing based on what you've shared. Immediate professional support is crucial. Please consider reaching out to emergency services at 999 or Samaritans at 116 123. Your life matters."
            ],
            general: [
                "Thank you for sharing that with me. It takes courage to open up about how you're feeling. What would be most helpful for you right now - practical strategies, emotional support, or just someone to listen?",
                "I appreciate you trusting me with this. Let's work together to find what might help. Would you like to explore some coping strategies, or would you prefer to talk more about what's coming up for you?",
                "I'm here to support you without judgment. Whatever you're experiencing is valid. What would feel most supportive for you in this moment?"
            ]
        };

        // Crisis detection keywords
        const CRISIS_KEYWORDS = ['suicide', 'kill myself', 'end it all', 'want to die', 'harm myself', 'not want to live'];

        // Auth System
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('mindguard_users') || '[]');

        // Initialize
        function init() {
            const savedUser = localStorage.getItem('mindguard_current_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
            } else {
                showAuth();
            }
            
            // Setup event listeners
            document.getElementById('login-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            document.getElementById('signup-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') signup();
            });
            
            console.log('MindGuard initialized with enhanced CBT AI');
        }

        // Enhanced AI functions
        function generateAIResponse(message) {
            const lowerMsg = message.toLowerCase();
            
            // Crisis detection
            if (CRISIS_KEYWORDS.some(keyword => lowerMsg.includes(keyword))) {
                return CBT_RESPONSES.crisis[Math.floor(Math.random() * CBT_RESPONSES.crisis.length)];
            }
            
            // Category-based responses
            if (lowerMsg.includes('anxious') || lowerMsg.includes('anxiety') || lowerMsg.includes('overwhelm') || lowerMsg.includes('panic')) {
                return CBT_RESPONSES.anxiety[Math.floor(Math.random() * CBT_RESPONSES.anxiety.length)];
            }
            else if (lowerMsg.includes('depress') || lowerMsg.includes('hopeless') || lowerMsg.includes('sad') || lowerMsg.includes('empty')) {
                return CBT_RESPONSES.depression[Math.floor(Math.random() * CBT_RESPONSES.depression.length)];
            }
            else if (lowerMsg.includes('stress') || lowerMsg.includes('pressure') || lowerMsg.includes('overwhelm')) {
                return CBT_RESPONSES.stress[Math.floor(Math.random() * CBT_RESPONSES.stress.length)];
            }
            else {
                return CBT_RESPONSES.general[Math.floor(Math.random() * CBT_RESPONSES.general.length)];
            }
        }

        // Auth functions
        function showTab(tabName) {
            document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(form => form.style.display = 'none');
            
            document.querySelector(`.auth-tab:nth-child(${tabName === 'login' ? '1' : '2'})`).classList.add('active');
            document.getElementById(`${tabName}-form`).style.display = 'block';
            
            document.getElementById(`${tabName}-error`).textContent = '';
        }

        function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('mindguard_current_user', JSON.stringify(user));
                showApp();
                alert(`Welcome back, ${user.name}!`);
            } else {
                document.getElementById('login-error').textContent = 'Invalid email or password';
            }
        }

        function signup() {
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            if (password.length < 6) {
                document.getElementById('signup-error').textContent = 'Password must be at least 6 characters';
                return;
            }
            
            if (users.find(u => u.email === email)) {
                document.getElementById('signup-error').textContent = 'Email already registered';
                return;
            }
            
            const newUser = {
                id: Date.now().toString(),
                name,
                email,
                password,
                trialEnds: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                isSubscribed: false,
                chatHistory: []
            };
            
            users.push(newUser);
            localStorage.setItem('mindguard_users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('mindguard_current_user', JSON.stringify(newUser));
            
            showApp();
            alert(`Welcome to MindGuard, ${name}! Your 3-day free trial has started.`);
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('mindguard_current_user');
            showAuth();
            alert('Logged out successfully');
        }

        function showAuth() {
            document.getElementById('auth-modal').style.display = 'flex';
            document.getElementById('app-content').style.display = 'none';
            document.getElementById('user-panel').style.display = 'none';
            document.getElementById('paywall').style.display = 'none';
            
            // Clear form fields
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
            document.getElementById('signup-name').value = '';
            document.getElementById('signup-email').value = '';
            document.getElementById('signup-password').value = '';
        }

        function showApp() {
            document.getElementById('auth-modal').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
            document.getElementById('user-panel').style.display = 'block';
            
            // Update user panel
            document.getElementById('user-email').textContent = currentUser.email;
            
            // Check access
            checkAccess();
        }

        function checkAccess() {
            const trialEnd = new Date(currentUser.trialEnds);
            const now = new Date();
            const hasAccess = currentUser.isSubscribed || now < trialEnd;
            
            if (hasAccess) {
                document.getElementById('paywall').style.display = 'none';
            } else {
                document.getElementById('paywall').style.display = 'block';
            }
        }

        // Chat functions
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message) {
                addMessage('user', message);
                input.value = '';
                
                // Simulate AI response
                setTimeout(() => {
                    const response = generateAIResponse(message);
                    addMessage('ai', response);
                }, 1000);
            }
        }

        function addMessage(sender, text) {
            const container = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            messageDiv.innerHTML = `<strong>${sender === 'user' ? 'You' : 'MindGuard'}:</strong> ${text}`;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function quickResponse(message) {
            document.getElementById('chat-input').value = message;
            sendMessage();
        }

        function handleChatInput(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Tool functions
        function startBreathingExercise() {
            alert('üí® Square Breathing Exercise:\n\n‚Ä¢ Breathe in for 4 seconds\n‚Ä¢ Hold for 4 seconds\n‚Ä¢ Breathe out for 4 seconds\n‚Ä¢ Hold for 4 seconds\n\nRepeat this cycle 4 times. Focus on the rhythm of your breath.');
        }

        function startGroundingExercise() {
            alert('üåç 5-4-3-2-1 Grounding Technique:\n\n‚Ä¢ 5 things you can see\n‚Ä¢ 4 things you can touch\n‚Ä¢ 3 things you can hear\n‚Ä¢ 2 things you can smell\n‚Ä¢ 1 thing you can taste\n\nThis helps bring you back to the present moment.');
        }

        function showGratitudePrompt() {
            const gratitude = prompt('What is one thing you\'re grateful for today?');
            if (gratitude) {
                addMessage('user', 'I want to practice gratitude');
                setTimeout(() => {
                    addMessage('ai', `Thank you for sharing that. "${gratitude}" is something beautiful to appreciate. Practicing gratitude regularly can significantly improve mental wellbeing.`);
                }, 1000);
            }
        }

        function showMoodTracker() {
            const mood = prompt('How are you feeling right now? (1-10, where 10 is amazing)');
            if (mood) {
                addMessage('user', 'I want to track my mood');
                setTimeout(() => {
                    addMessage('ai', `Thank you for checking in with yourself. Your mood at ${mood}/10 is noted. Remember that moods fluctuate, and it\'s okay to have different feelings throughout the day.`);
                }, 1000);
            }
        }

        function showEmergencyModal() {
            alert('üÜò EMERGENCY CONTACTS:\n\nüìû UK Samaritans: 116 123 (FREE, 24/7)\nüìû NHS: 111 (Non-emergency)\nüìû Emergency: 999\n\nYou are not alone. Professional help is available right now.');
        }

        function subscribe() {
            alert('üîí Subscription system would connect to Stripe here.\n\nIn production, this would redirect to a secure ¬£10/month payment page.');
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
